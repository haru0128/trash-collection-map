<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>高知市ゴミ収集マップ（可燃＋プラ統合）</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }

    .title {
      position: absolute; top: 10px; left: 50px; z-index: 1000;
      background: rgba(255,255,255,0.9); padding: 6px 12px;
      font-size: 16px; font-weight: bold; border-radius: 6px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
    }

    .search-box {
      position: absolute; top: 50px; left: 50px; z-index: 1000;
      background: white; padding: 8px; border-radius: 4px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3); font-size: 14px;
    }
    .search-box input { width: 160px; padding: 4px; }
  </style>
</head>
<body>

<div class="title">高知市ゴミ収集マップ</div>

<div class="search-box">
  <strong>町名検索</strong><br>
  <input type="text" id="searchInput" placeholder="例：旭町">
  <button id="searchBtn">検索</button>
</div>

<div id="map"></div>

<script>
/* 地図初期化 */
const map = L.map('map').setView([33.56, 133.52], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

/* アイコン定義 */
const iconBase = "https://rawcdn.githack.com/pointhi/leaflet-color-markers/master/img/";
const shadow = "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png";

const icons = {
  monThu: L.icon({ iconUrl: iconBase+"marker-icon-red.png",   shadowUrl: shadow, iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34]}),
  tueFri: L.icon({ iconUrl: iconBase+"marker-icon-blue.png",  shadowUrl: shadow, iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34]}),
  mountain: L.icon({ iconUrl: iconBase+"marker-icon-green.png",shadowUrl: shadow, iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34]})
};

/* ピンデータ（各色 +5本増加、プラごみは赤・青ピンに統合） */
const points = [
  // 赤ピン（Mon/Thu） 15本
  ["本町","monThu",33.5599,133.5317],
  ["帯屋町","monThu",33.5607,133.5329],
  ["北久保","monThu",33.5751,133.5376],
  ["南久保","monThu",33.5681,133.5421],
  ["比島町","monThu",33.5716,133.5274],
  ["小津町","monThu",33.5692,133.5189],
  ["塩田町","monThu",33.5764,133.5259],
  ["愛宕町","monThu",33.5724,133.5235],
  ["円行寺","monThu",33.5928,133.5207],
  ["万々北","monThu",33.5780,133.5155],
  ["一宮","monThu",33.5847,133.5563],
  ["薊野","monThu",33.5801,133.5492],
  ["初月町","monThu",33.5836,133.5232],
  ["秦南町","monThu",33.5759,133.5206],
  ["北御座","monThu",33.5635,133.5320],

  // 青ピン（Tue/Fri） 15本
  ["朝倉","tueFri",33.5485,133.4867],
  ["鴨部","tueFri",33.5466,133.5073],
  ["神田","tueFri",33.5388,133.5217],
  ["潮江","tueFri",33.5404,133.5284],
  ["横浜","tueFri",33.5082,133.5715],
  ["仁井田","tueFri",33.4978,133.5669],
  ["旭町","tueFri",33.5568,133.5141],
  ["中須賀町","tueFri",33.5584,133.5442],
  ["城山町","tueFri",33.5527,133.5458],
  ["高見町","tueFri",33.5453,133.5499],
  ["桟橋通","tueFri",33.5286,133.5339],
  ["六泉寺町","tueFri",33.5321,133.5254],
  ["若松町","tueFri",33.5267,133.5439],
  ["二葉町","tueFri",33.5252,133.5371],
  ["南竹島町","tueFri",33.5209,133.5296],

  // 緑ピン（山間部） 10本
  ["鏡今井","mountain",33.6246,133.4703],
  ["土佐山桑尾","mountain",33.6468,133.4112],
  ["春野町弘岡","mountain",33.4812,133.4637],
  ["鏡中谷","mountain",33.6180,133.4800],
  ["土佐山高川","mountain",33.6420,133.4200],
  ["春野町田井","mountain",33.4900,133.4700],
  ["鏡山手","mountain",33.6205,133.4655],
  ["土佐山北","mountain",33.6500,133.4300],
  ["春野町西川","mountain",33.4850,133.4550],
  ["鏡奥谷","mountain",33.6270,133.4680]
];

/* マーカー生成 */
const markers = [];
points.forEach(p => {
  const marker = L.marker([p[2], p[3]], { icon: icons[p[1]] }).addTo(map);
  let label;
  if(p[1]==="monThu") label="可燃ごみ（月・木）＋プラごみ（水曜日）";
  if(p[1]==="tueFri") label="可燃ごみ（火・金）＋プラごみ（水曜日）";
  if(p[1]==="mountain") label="山間部（収集注意）";
  marker.bindPopup(`<strong>${p[0]}</strong><br>${label}`);
  markers.push({ name: p[0], marker });
});

/* 町名検索 */
function searchTown(){
  let keyword = document.getElementById("searchInput").value.trim();
  if(!keyword) return;
  keyword = keyword.replace(/\s+/g,"");
  const hit = markers.find(m=>m.name.replace(/\s+/g,"").includes(keyword));
  if(hit){
    map.setView(hit.marker.getLatLng(),15);
    hit.marker.openPopup();
  } else alert("該当する町名が見つかりません");
}

document.getElementById("searchBtn").addEventListener("click", searchTown);
</script>

</body>
</html>
